<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Data Shield Assessment</title>
    
    <!-- âš¡ LOAD TAILWIND CSS CDN âš¡ --><script src="https://cdn.tailwindcss.com"></script>

    <script>
        // --- Tailwind Configuration for Custom Colors ---
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mds-blue': '#1f4f89',      /* Primary Blue */
                        'mds-primary': '#7C3AED',   /* Vibrant Purple (Inspired by Setter AI example) */
                        'mds-green': '#10B981',     /* Strong Compliance Green */
                        'mds-red': '#EF4444',       /* Strong Danger Red */
                        'mds-dark': '#1A1A1A',      /* Near-Black Text */
                        'mds-separator': '#e5e7eb', /* Very light border */
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>

    <!-- ðŸ’¡ CUSTOM STYLES (Focus on modern, vibrant buttons) ðŸ’¡ --><style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF; /* Pure white background */
            color: theme('colors.mds-dark');
        }

        /* NEW: Base button style - Rounded, lifted, transition effects */
        .btn-qa {
            @apply w-28 py-3 text-lg font-semibold transition-all duration-300 rounded-lg shadow-lg border-2;
            /* Default non-selected style */
            @apply border-gray-300 text-gray-700 bg-white hover:bg-gray-50 hover:shadow-xl;
        }

        /* YES Button specific styling (Default is the primary CTA color) */
        .btn-yes {
            @apply bg-mds-primary text-white border-mds-primary shadow-mds-primary/50 hover:shadow-mds-primary/80;
        }
        
        /* NO Button specific styling (Default is outline/secondary) */
        .btn-no {
            @apply bg-white text-mds-dark border-gray-300 hover:border-gray-500;
        }

        /* Selected YES state - High contrast green confirmation */
        .btn-yes.selected {
            @apply !bg-mds-green !text-white !border-mds-green !shadow-mds-green/70 scale-105;
        }

        /* Selected NO state - High contrast red warning */
        .btn-no.selected {
            @apply !bg-mds-red !text-white !border-mds-red !shadow-mds-red/70 scale-105;
        }

        /* Standard text selection */
        ::selection {
            background: #D1E5F8;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- ========================================================================= --><!-- 1. NAVIGATION BAR (Tailwind) --><!-- ========================================================================= --><nav class="sticky top-0 z-10 w-full bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
            <a class="text-xl font-semibold text-mds-dark tracking-tight" href="#">mydatashield.org</a>
            <div class="hidden md:flex space-x-6 text-md">
                <a href="#hero" class="text-mds-dark hover:text-mds-blue transition">Assessment</a>
                <a href="#about" class="text-mds-dark hover:text-mds-blue transition">About</a>
                <a href="#contact" class="text-mds-dark hover:text-mds-blue transition">Contact</a>
            </div>
        </div>
    </nav>
    
    <!-- ========================================================================= --><!-- 2. MAIN CONTENT AREA (Updated Layout) --><!-- ========================================================================= --><main id="hero" class="pt-16 pb-24">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="w-full">
                
                <h1 class="text-3xl sm:text-4xl font-extrabold text-mds-dark mb-2 leading-tight">
                    Medical Director: Critical Risk Exposure
                </h1>
                
                <p class="text-lg text-gray-500 mb-12">
                    Regulation X Compliance Self-Assessment for December 2025 Deadlines.
                </p>
                
                <!-- QUESTION CONTAINER -->
                <div class="space-y-6">
                
                    <!-- QUESTION 1 -->
                    <div class="question-block border-b border-mds-separator py-6" data-question-id="q1">
                        <!-- Enforced two-column layout: Question takes 60%, Buttons take 40% (or less) -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <p class="text-lg font-medium text-mds-dark mb-4 md:mb-0 md:mr-10 flex-1">
                                Medical Director, could you produce your Technical and Organizational Measures (TOMS) in 24 hours if needed?
                            </p>
                            <!-- High contrast button container -->
                            <div class="flex space-x-4">
                                <button class="btn-qa btn-yes" onclick="selectAnswer('q1', 'yes')">Yes</button>
                                <button class="btn-qa btn-no" onclick="selectAnswer('q1', 'no')">No</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- QUESTION 2 -->
                    <div class="question-block border-b border-mds-separator py-6" data-question-id="q2">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <p class="text-lg font-medium text-mds-dark mb-4 md:mb-0 md:mr-10 flex-1">
                                Do all your patient data systems log access and modification attempts in an unalterable fashion?
                            </p>
                            <div class="flex space-x-4">
                                <button class="btn-qa btn-yes" onclick="selectAnswer('q2', 'yes')">Yes</button>
                                <button class="btn-qa btn-no" onclick="selectAnswer('q2', 'no')">No</button>
                            </div>
                        </div>
                    </div>

                    <!-- QUESTION 3 (Last question, no bottom border) -->
                    <div class="question-block py-6" data-question-id="q3">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <p class="text-lg font-medium text-mds-dark mb-4 md:mb-0 md:mr-10 flex-1">
                                Is mandatory security training completed and verified for 100% of staff annually?
                            </p>
                            <div class="flex space-x-4">
                                <button class="btn-qa btn-yes" onclick="selectAnswer('q3', 'yes')">Yes</button>
                                <button class="btn-qa btn-no" onclick="selectAnswer('q3', 'no')">No</button>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- END QUESTION CONTAINER -->
                
                <div class="mt-16 pt-8 border-t border-gray-200 text-center">
                    <p class="text-gray-400 text-sm">Your progress is automatically saved to your secure profile. Continue at any time.</p>
                </div>

            </div>
        </div>
    </main>

    <!-- ========================================================================= --><!-- 3. FOOTER (Tailwind) --><!-- ========================================================================= --><footer id="contact" class="bg-mds-dark py-6">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-white text-sm opacity-80">&copy; 2025 mydatashield.org. | 
                <a href="#about" class="text-white hover:text-mds-blue transition duration-150">About</a> | 
                <a href="#" class="text-white hover:text-mds-blue transition duration-150">Privacy</a> | 
                <a href="#" class="text-white hover:text-mds-blue transition duration-150">Terms</a>
            </p>
        </div>
    </footer>
    
    <!-- ========================================================================= --><!-- JAVASCRIPT LOGIC FOR BUTTON STATE AND FIREBASE --><!-- ========================================================================= --><script type="module">
        import { initializeApp as initApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Check for Firebase variables and set up authentication if they exist
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let db, auth, userId;
        
        // --- Core State Variables ---
        const questionIds = ['q1', 'q2', 'q3']; 
        window.currentAnswers = {}; 
        // -------------------------------------------------

        // Function to initialize Firebase and load saved state
        async function initializeApp() {
            if (typeof setLogLevel !== 'undefined') {
                setLogLevel('debug');
            }

            try {
                const app = initApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in the user
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser.uid;
                console.log("Firebase initialized and user signed in:", userId);

                // Start listening for assessment state changes
                loadAssessmentState();

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                // Fallback if Firebase fails: use localStorage
                loadStateFromStorage();
            }
        }

        // --- Core State Management Logic ---
        
        function getDocRef(questionId) {
            if (!db || !userId) return null;
            // Store data privately for the current user in a collection called 'assessment'
            return doc(db, 'artifacts', appId, 'users', userId, 'assessment', questionId);
        }

        // Save state using Firestore (or localStorage if DB is unavailable)
        async function saveAssessmentState(questionId, answer) {
            if (db && userId) {
                try {
                    // Update state in Firestore
                    await setDoc(getDocRef(questionId), { answer: answer, timestamp: new Date() }, { merge: true });
                    console.log(`State saved to Firestore: ${questionId} = ${answer}`);
                } catch (e) {
                    console.error("Error saving document to Firestore:", e);
                    // Fallback to localStorage if Firestore save fails
                    localStorage.setItem(questionId, answer);
                }
            } else {
                // Fallback to localStorage
                localStorage.setItem(questionId, answer);
                console.log(`State saved to localStorage: ${questionId} = ${answer}`);
            }
            // Note: applySelectionToDOM updates currentAnswers
        }

        // Load state using Firestore listener (or localStorage if DB is unavailable)
        function loadAssessmentState() {
            if (!db || !userId) {
                // Fallback if Firestore functions aren't available
                loadStateFromStorage();
                return;
            }
            
            questionIds.forEach(questionId => {
                const qRef = getDocRef(questionId);
                if (qRef) {
                    onSnapshot(qRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const answer = docSnap.data().answer;
                            if (answer) {
                                applySelectionToDOM(questionId, answer);
                            }
                        } else {
                            // Fallback check to localStorage if no Firestore data is found
                            const localAnswer = localStorage.getItem(questionId);
                            if(localAnswer) {
                                applySelectionToDOM(questionId, localAnswer);
                            }
                        }
                    }, (error) => {
                        console.error(`Error setting up Firestore listener for ${questionId}:`, error);
                    });
                }
            });
        }

        // Load state from localStorage (used if Firebase initialization fails)
        function loadStateFromStorage() {
             questionIds.forEach(questionId => {
                 const answer = localStorage.getItem(questionId);
                 if (answer) {
                    applySelectionToDOM(questionId, answer);
                 }
             });
        }

        // Apply the visual state change to the buttons
        function applySelectionToDOM(questionId, answer) {
            const questionBlock = document.querySelector(`[data-question-id="${questionId}"]`);
            if (questionBlock) {
                // 1. Remove 'selected' class from all buttons in this block
                questionBlock.querySelectorAll('.btn-qa').forEach(btn => btn.classList.remove('selected'));

                // 2. Find the selected button and add the 'selected' class
                const selectedButton = questionBlock.querySelector(`.btn-${answer}`);
                if (selectedButton) {
                    selectedButton.classList.add('selected');
                }
            }
            
            // Update local state 
            window.currentAnswers[questionId] = answer;
        }
        
        // The main function called when a button is clicked
        window.selectAnswer = function(questionId, answer) {
            // Apply visual change immediately (which also updates state)
            applySelectionToDOM(questionId, answer); 

            // Save state (to Firestore or localStorage)
            saveAssessmentState(questionId, answer);
        }

        // Initialize the app and load saved state on page load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
