<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Data Shield Assessment</title>

    <!-- âš¡ STEP 1: LOAD BOOTSTRAP CSS FIRST âš¡ --><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ðŸ’¡ STEP 2: CUSTOM STYLES (LOADED AFTER BOOTSTRAP TO OVERWRITE DEFAULTS) ðŸ’¡ --><style>
        /* --- MODERN MINIMALIST PALETTE --- */
        :root {
            --mds-dark: #212529;      /* Muted dark grey for text and UI elements */
            --mds-blue: #1f4f89;      /* Professional Corporate Blue (Primary Action Color) */
            --mds-green: #2F7E4F;     /* Compliance Green for YES/Success */
            --mds-red: #e53e3e;       /* Danger/No Red */
            
            --bs-primary: var(--mds-blue);
            --bs-danger: var(--mds-red);
            --bs-success: var(--mds-green);
            --bs-dark: var(--mds-dark);
            --bs-body-bg: #F8F9FA; /* Subtle light gray background for the page */
        }
        
        body {
            background-color: var(--bs-body-bg) !important;
            color: var(--mds-dark);
            font-family: 'Inter', sans-serif;
        }
        
        /* --- ALIGNMENT FIX (Generous Horizontal Spacing) --- */
        .container {
            max-width: 1000px; /* Limit main container width */
        }
        
        /* --- NAVIGATION BAR --- */
        .navbar-brand {
            font-weight: 600; /* Medium-bold for logo */
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        /* --- CONTENT CARD STYLING --- */
        .assessment-card {
            background-color: #FFFFFF;
            border-radius: 12px; /* Soft rounded corners */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); /* Subtle shadow lift */
            padding: 3rem; /* Generous padding inside the card */
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        /* --- TITLE STYLING (CLEAN & PROFESSIONAL) --- */
        .assessment-main-title {
            font-size: 2.5rem; 
            font-weight: 700;  
            color: var(--mds-dark);
            line-height: 1.2;
        }
        
        /* Subtitle styling */
        .lead-subtitle {
            font-size: 1.1rem;
            font-weight: 400;
            color: #6c757d; 
            margin-top: 0.5rem;
            margin-bottom: 3rem;
        }

        /* --- QUESTION BUTTON STYLING (PILL-SHAPED) --- */
        .btn-qa {
            background-color: #FFFFFF;
            color: var(--mds-dark);
            border: 1px solid #cbd5e0; 
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
            width: 80px;
            padding: 8px 0;
            border-radius: 9999px; 
            text-align: center;
        }
        
        /* Selected states - Now Green and Red for compliance */
        .btn-yes.selected {
            background-color: var(--bs-success) !important;
            color: #FFFFFF !important;
            border-color: var(--bs-success);
        }

        .btn-no.selected {
            background-color: var(--bs-danger) !important;
            color: #FFFFFF !important;
            border-color: var(--bs-danger);
        }
        
        /* --- QUESTION BLOCK STYLING --- */
        .question-text {
            font-size: 1rem; 
            font-weight: 500;
            line-height: 1.5;
            margin-bottom: 0;
            flex-grow: 1;
        }

        .question-block {
            padding-top: 20px; 
            padding-bottom: 20px; 
            border-top: 1px solid #e9ecef; /* Light separator line */
        }
        .question-block:first-child {
            border-top: none; /* No top border on the first item */
        }
        
        .question-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .button-group {
            display: flex;
            gap: 10px; 
            /* Added min-width to prevent buttons from wrapping question text on smaller screens */
            min-width: 170px; 
            justify-content: flex-end;
        }
        
        /* --- FOOTER STYLING --- */
        .footer-dark {
            background-color: var(--mds-dark) !important;
            color: #ffffff;
        }
        .footer-dark a {
            color: #ffffff;
            font-weight: 500;
            text-decoration: none;
            transition: color 0.2s;
        }
        .footer-dark a:hover {
            color: #ccc;
        }
        
        /* Mobile layout adjustments */
        @media (max-width: 768px) {
            .assessment-card {
                padding: 1.5rem; /* Less padding on small screens */
            }
            .question-container {
                /* Stack question text and buttons on mobile */
                flex-direction: column;
                align-items: flex-start;
            }
            .question-text {
                margin-bottom: 15px;
            }
            .button-group {
                /* On mobile, make buttons full width for better tapping */
                width: 100%;
                justify-content: space-around;
                min-width: unset;
            }
            .btn-qa {
                width: 45%;
            }
        }
    </style>
</head>
<body>

    <!-- ========================================================================= --><!-- 1. NAVIGATION BAR (Clean, white background, better padding) --><!-- ========================================================================= --><nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm fixed-top">
        <div class="container">
            <a class="navbar-brand text-dark" href="#">mydatashield.org</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active text-dark" aria-current="page" href="#hero">Assessment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Added margin-top to offset the fixed navbar --><main id="hero" class="py-5" style="margin-top: 5rem;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    
                    <!-- 2. ASSESSMENT CARD (New Wrapper) --><div class="assessment-card">
                        
                        <h1 class="assessment-main-title">
                            Digital Readiness Assessment
                        </h1>
                        
                        <p class="lead-subtitle">
                            This self-assessment gauges compliance and preparedness for Regulation X, ensuring readiness for the December 2025 deadlines.
                        </p>
                        
                        <!-- QUESTION CONTAINER --><div class="assessment-section">
                        
                            <!-- QUESTION 1 --><div class="question-block" data-question-id="q1">
                                <div class="question-container">
                                    <p class="question-text me-4">Medical Director, could you produce your Technical and Organizational Measures (TOMS) in 24 hours if needed?</p>
                                    <div class="button-group">
                                        <button class="btn btn-qa btn-yes" onclick="selectAnswer('q1', 'yes')">Yes</button>
                                        <button class="btn btn-qa btn-no" onclick="selectAnswer('q1', 'no')">No</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- QUESTION 2 (Placeholder) --><div class="question-block" data-question-id="q2">
                                <div class="question-container">
                                    <p class="question-text me-4">Do all your patient data systems log access and modification attempts in an unalterable fashion?</p>
                                    <div class="button-group">
                                        <button class="btn btn-qa btn-yes" onclick="selectAnswer('q2', 'yes')">Yes</button>
                                        <button class="btn btn-qa btn-no" onclick="selectAnswer('q2', 'no')">No</button>
                                    </div>
                                </div>
                            </div>

                            <!-- QUESTION 3 (Placeholder) --><div class="question-block" data-question-id="q3">
                                <div class="question-container">
                                    <p class="question-text me-4">Is mandatory security training completed and verified for 100% of staff annually?</p>
                                    <div class="button-group">
                                        <button class="btn btn-qa btn-yes" onclick="selectAnswer('q3', 'yes')">Yes</button>
                                        <button class="btn btn-qa btn-no" onclick="selectAnswer('q3', 'no')">No</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                        
                        <div class="pt-4 mt-3 text-center">
                            <p class="text-muted small mb-0">Your progress is automatically saved. Continue at any time.</p>
                        </div>

                    </div>
                    <!-- END ASSESSMENT CARD -->

                </div>
            </div>
        </div>
    </main>

    <!-- ========================================================================= --><!-- 3. FOOTER --><!-- ========================================================================= --><footer id="contact" class="footer-dark py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0 small">&copy; 2025 mydatashield.org. | <a href="#about" class="text-white">About</a> | <a href="#" class="text-white">Privacy</a> | <a href="#" class="text-white">Terms</a></p>
        </div>
    </footer>
    
    <!-- âš¡ BOOTSTRAP JAVASCRIPT LINK âš¡ --><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ========================================================================= --><!-- JAVASCRIPT LOGIC FOR BUTTON STATE AND FIREBASE --><!-- ========================================================================= --><script type="module">
        import { initializeApp as initApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Check for Firebase variables and set up authentication if they exist
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let db, auth, userId;
        
        // --- Core State Variables ---
        const questionIds = ['q1', 'q2', 'q3']; 
        window.currentAnswers = {}; // Expose globally for simplicity if needed elsewhere
        // -------------------------------------------------

        // Function to initialize Firebase and load saved state
        async function initializeApp() {
            if (typeof setLogLevel !== 'undefined') {
                setLogLevel('debug');
            }

            try {
                const app = initApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in the user
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser.uid;
                console.log("Firebase initialized and user signed in:", userId);

                // Start listening for assessment state changes
                loadAssessmentState();

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                // Fallback if Firebase fails: use localStorage
                loadStateFromStorage();
            }
        }

        // --- Core State Management Logic ---
        
        function getDocRef(questionId) {
            if (!db || !userId) return null;
            // Store data privately for the current user in a collection called 'assessment'
            return doc(db, 'artifacts', appId, 'users', userId, 'assessment', questionId);
        }

        // Save state using Firestore (or localStorage if DB is unavailable)
        async function saveAssessmentState(questionId, answer) {
            if (db && userId) {
                try {
                    // Update state in Firestore
                    await setDoc(getDocRef(questionId), { answer: answer, timestamp: new Date() }, { merge: true });
                    console.log(`State saved to Firestore: ${questionId} = ${answer}`);
                } catch (e) {
                    console.error("Error saving document to Firestore:", e);
                    // Fallback to localStorage if Firestore save fails
                    localStorage.setItem(questionId, answer);
                }
            } else {
                // Fallback to localStorage
                localStorage.setItem(questionId, answer);
                console.log(`State saved to localStorage: ${questionId} = ${answer}`);
            }
            // Note: applySelectionToDOM updates currentAnswers
        }

        // Load state using Firestore listener (or localStorage if DB is unavailable)
        function loadAssessmentState() {
            if (!db || !userId) {
                // Fallback if Firestore functions aren't available
                loadStateFromStorage();
                return;
            }
            
            questionIds.forEach(questionId => {
                const qRef = getDocRef(questionId);
                if (qRef) {
                    onSnapshot(qRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const answer = docSnap.data().answer;
                            if (answer) {
                                applySelectionToDOM(questionId, answer);
                            }
                        } else {
                            // Fallback check to localStorage if no Firestore data is found
                            const localAnswer = localStorage.getItem(questionId);
                            if(localAnswer) {
                                applySelectionToDOM(questionId, localAnswer);
                            }
                        }
                    }, (error) => {
                        console.error(`Error setting up Firestore listener for ${questionId}:`, error);
                    });
                }
            });
        }

        // Load state from localStorage (used if Firebase initialization fails)
        function loadStateFromStorage() {
             questionIds.forEach(questionId => {
                 const answer = localStorage.getItem(questionId);
                 if (answer) {
                    applySelectionToDOM(questionId, answer);
                 }
             });
        }

        // Apply the visual state change to the buttons
        function applySelectionToDOM(questionId, answer) {
            const questionBlock = document.querySelector(`[data-question-id="${questionId}"]`);
            if (questionBlock) {
                // 1. Remove 'selected' class from all buttons in this block
                questionBlock.querySelectorAll('.btn-qa').forEach(btn => btn.classList.remove('selected'));

                // 2. Find the selected button and add the 'selected' class
                const selectedButton = questionBlock.querySelector(`.btn-${answer}`);
                if (selectedButton) {
                    selectedButton.classList.add('selected');
                }
            }
            
            // Update local state 
            window.currentAnswers[questionId] = answer;
        }
        
        // The main function called when a button is clicked
        window.selectAnswer = function(questionId, answer) {
            // Apply visual change immediately (which also updates state)
            applySelectionToDOM(questionId, answer); 

            // Save state (to Firestore or localStorage)
            saveAssessmentState(questionId, answer);
        }

        // Initialize the app and load saved state on page load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
