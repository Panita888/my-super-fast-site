<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Data Shield Assessment</title>

    <!-- âš¡ STEP 1: LOAD BOOTSTRAP CSS FIRST âš¡ --><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ðŸ’¡ STEP 2: CUSTOM STYLES (LOADED AFTER BOOTSTRAP TO OVERWRITE DEFAULTS) ðŸ’¡ --><style>
        /* --- MODERN MINIMALIST PALETTE --- */
        :root {
            /* Using pure black and white for highest contrast */
            --mds-dark: #212529;  /* Muted dark grey for text and UI elements */
            --mds-green: #38a169; /* Primary Action Green */
            --mds-red: #e53e3e;   /* Danger/No Red */
            
            --bs-primary: var(--mds-green);
            --bs-danger: var(--mds-red);
            --bs-success: var(--mds-green);
            --bs-dark: var(--mds-dark);
            --bs-body-bg: #FFFFFF;
        }
        
        /* Set everything to white background for a clean, edge-to-edge feel */
        body {
            background-color: var(--bs-body-bg) !important;
            color: var(--mds-dark);
            font-family: 'Inter', sans-serif;
        }
        
        /* --- ALIGNMENT FIX (Single Column) --- */
        /* Center the content container and add generous horizontal padding */
        @media (min-width: 992px) { 
            .container {
                max-width: 1000px; /* Focus the content */
            }
            /* Add extra horizontal padding to the hero section on desktop */
            #hero .container {
                padding-left: 80px !important; 
                padding-right: 80px !important;
            }
        }
        
        /* --- TITLE STYLING (NEW PROFESSIONAL LOOK) --- */
        .assessment-main-title {
            font-size: 2.5rem; /* Smaller than display-3 */
            font-weight: 700;  /* Bold but not "bolder" */
            color: var(--mds-dark);
            margin-bottom: 0.5rem; /* Closer to subtitle */
            line-height: 1.2;
        }

        /* --- QUESTION BUTTON STYLING (FLAT & PILL-SHAPED) --- */
        .btn-qa {
            background-color: #FFFFFF;
            color: var(--mds-dark);
            border: 1px solid #cbd5e0; /* Very light gray border when inactive */
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
            width: 80px;
            padding: 8px 0;
            border-radius: 9999px; /* Fully rounded/Pill shape */
        }
        
        .btn-qa:hover:not(.selected) {
            border-color: var(--mds-dark); /* Dark border on hover */
        }

        /* Persistent green state for 'Yes' (FLAT) */
        .btn-yes.selected {
            background-color: var(--bs-success) !important;
            color: #FFFFFF !important;
            border-color: var(--bs-success);
        }

        /* Persistent red state for 'No' (FLAT) */
        .btn-no.selected {
            background-color: var(--bs-danger) !important;
            color: #FFFFFF !important;
            border-color: var(--bs-danger);
        }
        
        /* --- QUESTION BLOCK STYLING (LINE DIVIDERS ONLY) --- */
        .question-text {
            font-size: 1.1rem; 
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 0;
            flex-grow: 1;
        }

        .question-block {
            /* Only a very subtle bottom border separates the questions */
            border-bottom: 1px solid #e2e8f0; 
            padding-top: 25px;
            padding-bottom: 25px;
            transition: background-color 0.2s;
        }
        .question-block:last-child {
            border-bottom: none; /* No border after the last item */
        }
        
        /* Container for the question text and button group */
        .question-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* FIX: Ensure buttons are always horizontal */
        .button-group {
            display: flex;
            gap: 10px; /* Space between Yes and No */
        }
        
        /* --- FOOTER STYLING --- */
        .footer-dark {
            background-color: var(--mds-dark) !important;
            color: #ffffff;
        }
        .footer-dark a {
            color: #ffffff;
            font-weight: 500;
            text-decoration: underline;
        }
        
        /* Mobile layout adjustments */
        @media (max-width: 576px) {
            .question-container {
                /* Keep question text and button group stacked */
                flex-direction: column;
                align-items: flex-start;
            }
            .question-text {
                margin-bottom: 15px;
            }
            /* The .button-group remains horizontal due to the FIX above */
        }
    </style>
</head>
<body>

    <!-- ========================================================================= --><!-- 1. NAVIGATION BAR (Clean, white background) --><!-- ========================================================================= --><nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
        <div class="container">
            <a class="navbar-brand text-dark fw-bold" href="#">mydatashield.org</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active text-dark" aria-current="page" href="#hero">Assessment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ========================================================================= --><!-- 2. MAIN ASSESSMENT AREA (FLAT, SPACIOUS DESIGN) --><!-- ========================================================================= --><main id="hero" class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12">
                    
                    <!-- UPDATED: PROFESSIONAL TITLE --><h2 class="assessment-main-title mb-3">
                        Medical Director, are you sure that your clinic is not falling short of Regulation X?
                    </h2>
                    
                    <!-- SUBTITLE --><p class="lead text-muted mb-5">
                        Full compliance is expected by Dec 2025 - are you ready?
                    </p>
                    
                    <!-- QUESTION CONTAINER (NO BOXES) --><div class="assessment-section">
                    
                        <!-- QUESTION 1 --><div class="question-block" data-question-id="q1">
                            <div class="question-container">
                                <p class="question-text me-4">Medical Director, could you produce your TOMS in 24 hours if needed?</p>
                                <div class="button-group">
                                    <button class="btn btn-qa btn-yes" onclick="selectAnswer('q1', 'yes')">Yes</button>
                                    <button class="btn btn-qa btn-no" onclick="selectAnswer('q1', 'no')">No</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- QUESTION 2 (Placeholder) --><div class="question-block" data-question-id="q2">
                            <div class="question-container">
                                <p class="question-text me-4">Do all your patient data systems log access and modification attempts?</p>
                                <div class="button-group">
                                    <button class="btn btn-qa btn-yes" onclick="selectAnswer('q2', 'yes')">Yes</button>
                                    <button class="btn btn-qa btn-no" onclick="selectAnswer('q2', 'no')">No</button>
                                </div>
                            </div>
                        </div>

                        <!-- QUESTION 3 (Placeholder) --><div class="question-block" data-question-id="q3">
                            <div class="question-container">
                                <p class="question-text me-4">Is mandatory security training completed by all staff annually?</p>
                                <div class="button-group">
                                    <button class="btn btn-qa btn-yes" onclick="selectAnswer('q3', 'yes')">Yes</button>
                                    <button class="btn btn-qa btn-no" onclick="selectAnswer('q3', 'no')">No</button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ========================================================================= --><!-- 3. FOOTER --><!-- ========================================================================= --><footer id="contact" class="footer-dark py-5 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 mydatashield.org. | <a href="#" class="text-white">Privacy</a> | <a href="#" class="text-white">Terms</a></p>
        </div>
    </footer>
    
    <!-- âš¡ BOOTSTRAP JAVASCRIPT LINK âš¡ --><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ========================================================================= --><!-- JAVASCRIPT LOGIC FOR BUTTON STATE (Firestore logic preserved) --><!-- ========================================================================= --><script>
        // Check for Firebase variables and set up authentication if they exist
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId;
        
        // Imported Firestore/Auth functions must be cached if we want to access them outside initializeApp
        let doc, setDoc, onSnapshot, getFirestore, setLogLevel; 

        // Function to initialize Firebase and load saved state
        async function initializeApp() {
            // Import necessary Firebase modules
            const firebaseAppModule = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
            const firebaseAuthModule = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
            const firebaseFirestoreModule = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");
            
            const { initializeApp: initApp } = firebaseAppModule;
            const { getAuth, signInWithCustomToken, signInAnonymously } = firebaseAuthModule;
            
            // Cache imported Firestore functions
            ({ getFirestore, doc, setDoc, onSnapshot, setLogLevel } = firebaseFirestoreModule); 
            
            // For debugging/logging Firestore operations
            if (typeof setLogLevel !== 'undefined') {
                setLogLevel('debug');
            }

            try {
                const app = initApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in the user
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser.uid;
                console.log("Firebase initialized and user signed in:", userId);

                // Start listening for assessment state changes
                loadAssessmentState();

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                // Fallback if Firebase fails: use localStorage
                loadStateFromStorage();
            }
        }

        // --- Core State Management Logic ---
        
        function getDocRef(questionId) {
            if (!doc || !db || !userId) return null;
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            // Store data privately for the current user in a collection called 'assessment'
            return doc(db, 'artifacts', appId, 'users', userId, 'assessment', questionId);
        }

        // Save state using Firestore (or localStorage if DB is unavailable)
        async function saveAssessmentState(questionId, answer) {
            if (db && userId && setDoc && doc) {
                try {
                    await setDoc(getDocRef(questionId), { answer: answer, timestamp: new Date() }, { merge: true });
                    console.log(`State saved to Firestore: ${questionId} = ${answer}`);
                } catch (e) {
                    console.error("Error saving document to Firestore:", e);
                    localStorage.setItem(questionId, answer);
                }
            } else {
                // Fallback to localStorage
                localStorage.setItem(questionId, answer);
                console.log(`State saved to localStorage: ${questionId} = ${answer}`);
            }
        }

        // Load state using Firestore listener (or localStorage if DB is unavailable)
        function loadAssessmentState() {
            if (!onSnapshot || !doc || !db || !userId) {
                // Fallback if Firestore functions aren't available
                loadStateFromStorage();
                return;
            }
            
            // List of question IDs to monitor (updated to include all questions)
            const questionIds = ['q1', 'q2', 'q3']; 

            questionIds.forEach(questionId => {
                const qRef = getDocRef(questionId);
                if (qRef) {
                    onSnapshot(qRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const answer = docSnap.data().answer;
                            if (answer) {
                                applySelectionToDOM(questionId, answer);
                            }
                        } else {
                            // Fallback check to localStorage if no Firestore data is found
                            const localAnswer = localStorage.getItem(questionId);
                            if(localAnswer) {
                                applySelectionToDOM(questionId, localAnswer);
                            }
                        }
                    }, (error) => {
                        console.error(`Error setting up Firestore listener for ${questionId}:`, error);
                    });
                }
            });
        }

        // Load state from localStorage (used if Firebase initialization fails)
        function loadStateFromStorage() {
             const questionIds = ['q1', 'q2', 'q3']; 
             questionIds.forEach(questionId => {
                 const answer = localStorage.getItem(questionId);
                 if (answer) {
                    applySelectionToDOM(questionId, answer);
                 }
             });
        }

        // Apply the visual state change to the buttons
        function applySelectionToDOM(questionId, answer) {
            const questionBlock = document.querySelector(`[data-question-id="${questionId}"]`);
            if (questionBlock) {
                // 1. Remove 'selected' class from all buttons in this block
                questionBlock.querySelectorAll('.btn-qa').forEach(btn => btn.classList.remove('selected'));

                // 2. Find the selected button and add the 'selected' class
                const selectedButton = questionBlock.querySelector(`.btn-${answer}`);
                if (selectedButton) {
                    selectedButton.classList.add('selected');
                }
            }
        }

        // The main function called when a button is clicked
        function selectAnswer(questionId, answer) {
            // Apply visual change immediately
            applySelectionToDOM(questionId, answer); 

            // Save state (to Firestore or localStorage)
            saveAssessmentState(questionId, answer);
        }

        // Initialize the app and load saved state on page load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
