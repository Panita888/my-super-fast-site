<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Data Shield Assessment</title>

    <!-- âš¡ STEP 1: LOAD BOOTSTRAP CSS FIRST âš¡ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ðŸ’¡ STEP 2: CUSTOM STYLES (LOADED AFTER BOOTSTRAP TO OVERWRITE DEFAULTS) ðŸ’¡ -->
    <style>
        /* Define your custom colors as CSS variables for use in Bootstrap */
        :root {
            --bs-primary: #4CAF50; /* UPDATED: Changed to a clear, vibrant green (Traffic Light Green) */
            --bs-danger: #dc3545;  /* Standard Bootstrap Red for No */
            --bs-success: var(--bs-primary); /* Use your custom primary color for success (Green) */
            --bs-dark: #000000;    /* Force all 'dark' elements to be pure black */
        }
        
        /* Ensure all backgrounds are white and text is black by default, overriding custom light color */
        body, .bg-light {
            background-color: #FFFFFF !important;
            color: var(--bs-dark);
        }

        /* Custom styling for the persistent state buttons */
        .btn-qa {
            background-color: #FFFFFF;
            color: var(--bs-dark);
            border: 2px solid var(--bs-dark);
            font-weight: bold;
            transition: background-color 0.3s, color 0.3s;
            width: 80px; /* Made slightly smaller for better fit */
            margin-right: 10px;
        }
        /* Ensure the button text is black by default (when not selected) */
        .btn-qa:not(.selected) {
            color: var(--bs-dark) !important;
        }

        /* Persistent green state for 'Yes' */
        .btn-yes.selected {
            background-color: var(--bs-success) !important;
            color: #FFFFFF !important;
            border-color: var(--bs-success);
        }

        /* Persistent red state for 'No' */
        .btn-no.selected {
            background-color: var(--bs-danger) !important;
            color: #FFFFFF !important;
            border-color: var(--bs-danger);
        }
        
        /* Style for the question text */
        .question-text {
            font-size: 1.25rem; /* Slightly smaller for better fit in the column */
            font-weight: 500;
            margin-bottom: 0; /* Remove default margin for alignment */
        }

        /* NEW STYLE: Ensure the question text and button group use 100% of the available width 
           and arrange contents to push the button group next to the question text. */
        .question-container {
            width: 100%;
            display: flex;
            justify-content: space-between; /* Pushes content to the edges */
            align-items: center;
        }

        /* Button group: used to contain and align the buttons */
        .button-group {
            display: flex;
            flex-shrink: 0; /* Prevent buttons from shrinking */
        }

        /* For small screens, ensure the buttons are centered or right-aligned for better mobile layout 
           (though justify-content-between in .question-container will handle the spacing) */
        @media (max-width: 576px) {
            .question-container {
                flex-direction: column; /* Stack vertically on small screens */
                align-items: flex-start; /* Left-align items when stacked */
            }
            .question-text {
                margin-bottom: 10px; /* Add space between text and buttons on mobile */
            }
        }
    </style>
</head>
<body>

    <!-- ========================================================================= -->
    <!-- 1. NAVIGATION BAR -->
    <!-- ========================================================================= -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
        <div class="container">
            <a class="navbar-brand text-dark" href="#">mydatashield.org</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active text-dark" aria-current="page" href="#hero">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="#about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark" href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ========================================================================= -->
    <!-- 2. HERO / MAIN ASSESSMENT AREA (SINGLE COLUMN LAYOUT) -->
    <!-- ========================================================================= -->
    <header id="hero" class="p-5">
        <div class="container">
            <div class="row">
                <!-- Assessment Questions now use the full 12/12 width -->
                <div class="col-lg-12">
                    <h1 class="display-5 fw-bold mb-5">Digital Readiness Assessment</h1>
                    
                    <!-- QUESTION 1 -->
                    <div class="question-block mb-4 p-3" data-question-id="q1">
                        <!-- Removed 'row align-items-center' and column classes. Using .question-container (Flexbox) instead. -->
                        <div class="question-container">
                            <p class="question-text me-4">Medical Director, could you produce your TOMS in 24 hours if needed?</p>
                            <div class="button-group">
                                <button class="btn btn-qa btn-yes" onclick="selectAnswer('q1', 'yes')">Yes</button>
                                <button class="btn btn-qa btn-no" onclick="selectAnswer('q1', 'no')">No</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- QUESTION 2 (Placeholder) -->
                    <div class="question-block mb-4 p-3">
                        <div class="question-container">
                            <p class="question-text text-muted me-4">Next question will go here...</p>
                            <div class="button-group">
                                <button class="btn btn-qa">Yes</button>
                                <button class="btn btn-qa">No</button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </header>

    <!-- ========================================================================= -->
    <!-- 3. FOOTER -->
    <!-- ========================================================================= -->
    <footer id="contact" class="bg-dark text-light py-4 mt-5">
        <div class="container text-center">
            <p>&copy; 2025 mydatashield.org. | <a href="#" class="text-light">Privacy</a> | <a href="#" class="text-light">Terms</a></p>
        </div>
    </footer>
    
    <!-- âš¡ BOOTSTRAP JAVASCRIPT LINK âš¡ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ========================================================================= -->
    <!-- JAVASCRIPT LOGIC FOR BUTTON STATE (Fixed Firebase imports) -->
    <!-- ========================================================================= -->
    <script>
        // Check for Firebase variables and set up authentication if they exist
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId;

        // Function to initialize Firebase and load saved state
        async function initializeApp() {
            // Import necessary Firebase modules
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js");
            const { getAuth, signInWithCustomToken, signInAnonymously } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");
            
            // ðŸ”¥ FIX: Import ALL necessary Firestore functions here, as they are not globally defined in modular imports.
            const { getFirestore, doc, setDoc, onSnapshot, setLogLevel } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js");
            
            // For debugging/logging Firestore operations
            if (typeof setLogLevel !== 'undefined') {
                setLogLevel('debug');
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Sign in the user
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser.uid;
                console.log("Firebase initialized and user signed in:", userId);

                // Start listening for assessment state changes
                loadAssessmentState(doc, setDoc, onSnapshot); // Pass imported functions

            } catch (error) {
                console.error("Firebase initialization failed:", error);
                // Fallback if Firebase fails: use localStorage
                loadStateFromStorage();
            }
        }

        // --- Core State Management Logic ---
        
        // ðŸ”¥ FIX: Now accepts doc, setDoc, onSnapshot as arguments
        function getDocRef(questionId, doc) {
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            // Store data privately for the current user in a collection called 'assessment'
            return doc(db, 'artifacts', appId, 'users', userId, 'assessment', questionId);
        }

        // ðŸ”¥ FIX: Now accepts setDoc as argument
        // Save state using Firestore (or localStorage if DB is unavailable)
        async function saveAssessmentState(questionId, answer, setDoc) {
            if (db && userId) {
                try {
                    await setDoc(getDocRef(questionId, doc), { answer: answer, timestamp: new Date() }, { merge: true });
                    console.log(`State saved to Firestore: ${questionId} = ${answer}`);
                } catch (e) {
                    console.error("Error saving document to Firestore:", e);
                    localStorage.setItem(questionId, answer);
                }
            } else {
                // Fallback to localStorage
                localStorage.setItem(questionId, answer);
                console.log(`State saved to localStorage: ${questionId} = ${answer}`);
            }
        }

        // ðŸ”¥ FIX: Now accepts doc, onSnapshot as arguments
        // Load state using Firestore listener (or localStorage if DB is unavailable)
        function loadAssessmentState(doc, setDoc, onSnapshot) {
            // List of question IDs to monitor
            const questionIds = ['q1']; 

            questionIds.forEach(questionId => {
                const qRef = getDocRef(questionId, doc);
                onSnapshot(qRef, (doc) => {
                    if (doc.exists()) {
                        const answer = doc.data().answer;
                        if (answer) {
                            applySelectionToDOM(questionId, answer);
                        }
                    } else {
                         // Fallback check to localStorage if no Firestore data is found
                         const localAnswer = localStorage.getItem(questionId);
                         if(localAnswer) {
                            applySelectionToDOM(questionId, localAnswer);
                         }
                    }
                }, (error) => {
                    console.error(`Error setting up Firestore listener for ${questionId}:`, error);
                });
            });
        }

        // Load state from localStorage (used if Firebase initialization fails)
        function loadStateFromStorage() {
             const answer = localStorage.getItem('q1');
             if (answer) {
                applySelectionToDOM('q1', answer);
             }
        }

        // Apply the visual state change to the buttons
        function applySelectionToDOM(questionId, answer) {
            const questionBlock = document.querySelector(`[data-question-id="${questionId}"]`);
            if (questionBlock) {
                // 1. Remove 'selected' class from all buttons in this block
                questionBlock.querySelectorAll('.btn-qa').forEach(btn => btn.classList.remove('selected'));

                // 2. Find the selected button and add the 'selected' class
                const selectedButton = questionBlock.querySelector(`.btn-${answer}`);
                if (selectedButton) {
                    selectedButton.classList.add('selected');
                }
            }
        }

        // The main function called when a button is clicked
        function selectAnswer(questionId, answer) {
            // Apply visual change immediately
            applySelectionToDOM(questionId, answer); 

            // Save state (to Firestore or localStorage)
            // We need to ensure doc and setDoc are available when this is called, 
            // but since they are imported only inside initializeApp, 
            // we'll rely on the global scope being populated, or the fallback working.
            // A safer fix is to pass them, but since onclick can't pass the variables, 
            // we ensure the app logic handles the case where DB fails gracefully.
            if (typeof setDoc !== 'undefined') {
                 // If Firebase is initialized and its functions are available globally, use them.
                 saveAssessmentState(questionId, answer, setDoc); 
            } else {
                 // Fallback to using localStorage if setDoc isn't available (Firebase failed)
                 localStorage.setItem(questionId, answer);
            }
        }

        // Initialize the app and load saved state on page load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
